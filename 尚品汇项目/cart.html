<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>30.购物车商品列表全选单选功能实现</title>
    <link rel="stylesheet" href="./css/reset.css">
    <link rel="stylesheet" href="./css/cart.css">
</head>

<body>
    <div class="outer">
        <!-- 窗口侧边栏 -->
        <div class="toolbar toolbar-wrap">
            <!-- 侧边栏的内容 -->
            <div class="content"></div>
            <!-- 面包屑 -->
            <div class="but list"></div>
            <!-- 中间列表 -->
            <ul class="toolList">
                <li class="pull">
                    <i class="tab-icon vip"></i>
                    <em>尚品会员</em>
                </li>
                <li class="pull">
                    <i class="tab-icon cart"></i>
                    <em>购物车</em>
                </li>
                <li class="pull">
                    <i class="tab-icon follow"></i>
                    <em>我的关注</em>
                </li>
                <li class="pull">
                    <i class="tab-icon history"></i>
                    <em>我的足迹</em>
                </li>
                <li class="pull">
                    <i class="tab-icon message"></i>
                    <em>我的消息</em>
                </li>
                <li class="pull">
                    <i class="tab-icon qus"></i>
                    <em>咨询</em>
                </li>
            </ul>

            <!-- 回到顶部按钮 -->
            <div class="back pull">
                <i class="tab-icon top"></i>
                <em>顶部</em>
            </div>
        </div>
        <!-- 头部 -->
        <header class="header">
            <!-- 头部的第一行 -->
            <div class="top">
                <div class="container">
                    <div class="loginList">
                        <p>尚品汇欢迎您！</p>
                        <p>
                            <span>请</span>
                            <a href="###">登录</a>
                            <a href="###" class="register">免费注册</a>
                        </p>
                    </div>
                    <div class="typeList">
                        <a href="###">我的订单</a>
                        <a href="###">我的购物车</a>
                        <a href="###">我的尚品汇</a>
                        <a href="###">尚品汇会员</a>
                        <a href="###">企业采购</a>
                        <a href="###">关注尚品汇</a>
                        <a href="###">合作招商</a>
                        <a href="###">商家后台</a>
                    </div>
                </div>
            </div>
            <!-- 头部第二行 搜索区域 -->
            <div class="bottom">
                <h1 class="logoArea">
                    <a href="###" title="尚品汇" class="logo" target="_blank">
                        <img src="./images/Logo.png" alt="尚品汇">
                    </a>
                </h1>
                <div class="searchArea">
                    <form action="###" class="searchForm">
                        <input type="text" class="inputSearch">
                        <button type="submit">搜索</button>
                    </form>
                </div>
            </div>
        </header>

        <!-- 商品导航分类 -->
        <div class="typeNav">
            <div class="container">
                <h2 class="all">全部商品分类</h2>
                <nav class="nav">
                    <a href="###">服装城</a>
                    <a href="###">美妆馆</a>
                    <a href="###">尚品汇超市</a>
                    <a href="###">全球购</a>
                    <a href="###">闪购</a>
                    <a href="###">团购</a>
                    <a href="###">有趣</a>
                    <a href="###">秒杀</a>
                </nav>
            </div>
        </div>

        <!-- 购物车列表 -->
        <div class="cart">
            <h4>全部商品</h4>
            <div class="cart-main">
                <div class="cart-th">
                    <div class="cart-th1">全部</div>
                    <div class="cart-th2">商品</div>
                    <div class="cart-th3">单价（元）</div>
                    <div class="cart-th4">数量</div>
                    <div class="cart-th5">小计（元）</div>
                    <div class="cart-th6">操作</div>
                </div>
                <div class="cart-body">

                </div>
                <div class="cart-tool">
                    <div class="select-all">
                        <input type="checkbox" class="chooseAll">
                        <span>全选</span>
                    </div>
                    <div class="option">
                        <a href="###" class="deleteAll">删除选中的商品</a>
                        <a href="###">移到我的关注</a>
                        <a href="###">清除下柜商品</a>
                    </div>
                    <div class="money-box">
                        <div class="choosed">
                            已经选择
                            <span>0</span>
                            件商品
                        </div>
                        <div class="sumprice">
                            <em>总价（不含运费） ：</em>
                            <i class="summoney">¥0</i>
                        </div>
                        <div class="sumbtn">
                            <a href="###">结算</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 底部 -->
        <div class="footer">
            <div class="footer-container">
                <div class="footerList">
                    <div class="footerItem">
                        <h4>购物指南</h4>
                        <ul class="footerItemCon">
                            <li>购物流程</li>
                            <li>会员介绍</li>
                            <li>生活旅行/团购</li>
                            <li>常见问题</li>
                            <li>购物指南</li>
                        </ul>

                    </div>
                    <div class="footerItem">
                        <h4>配送方式</h4>
                        <ul class="footerItemCon">
                            <li>上门自提</li>
                            <li>211限时达</li>
                            <li>配送服务查询</li>
                            <li>配送费收取标准</li>
                            <li>海外配送</li>
                        </ul>
                    </div>
                    <div class="footerItem">
                        <h4>支付方式</h4>
                        <ul class="footerItemCon">
                            <li>货到付款</li>
                            <li>在线支付</li>
                            <li>分期付款</li>
                            <li>邮局汇款</li>
                            <li>公司转账</li>
                        </ul>
                    </div>
                    <div class="footerItem">
                        <h4>售后服务</h4>
                        <ul class="footerItemCon">
                            <li>售后政策</li>
                            <li>价格保护</li>
                            <li>退款说明</li>
                            <li>返修/退换货</li>
                            <li>取消订单</li>
                        </ul>
                    </div>
                    <div class="footerItem">
                        <h4>特色服务</h4>
                        <ul class="footerItemCon">
                            <li>夺宝岛</li>
                            <li>DIY装机</li>
                            <li>延保服务</li>
                            <li>尚品汇E卡</li>
                            <li>尚品汇通信</li>
                        </ul>
                    </div>
                    <div class="footerItem">
                        <h4>帮助中心</h4>
                        <img src="./images/wx_cz.jpg">
                    </div>
                </div>
                <div class="copyright">
                    <ul class="helpLink">
                        <li>关于我们
                            <span class="space"></span>
                        </li>
                        <li>联系我们
                            <span class="space"></span>
                        </li>
                        <li>关于我们
                            <span class="space"></span>
                        </li>
                        <li>商家入驻
                            <span class="space"></span>
                        </li>
                        <li>营销中心
                            <span class="space"></span>
                        </li>
                        <li>友情链接
                            <span class="space"></span>
                        </li>
                        <li>关于我们
                            <span class="space"></span>
                        </li>
                        <li>营销中心
                            <span class="space"></span>
                        </li>
                        <li>友情链接
                            <span class="space"></span>
                        </li>
                        <li>关于我们</li>
                    </ul>
                    <p>地址：北京市昌平区宏福科技园综合楼6层</p>
                    <p>京ICP备19006430号</p>
                </div>
            </div>
        </div>
    </div>


    <script src="./js/cart.js"></script>
    <script>
        // window.onload是全部资源加载完成之后执行
        // DOMContentLoaded是等待节点加载完成之后执行，DOMContentLoaded是DOM2级事件，所以需要使用addEventListener监听
        window.addEventListener("DOMContentLoaded", function () {

            //1.侧边栏效果
            asideShow();
            function asideShow() {

                //面包屑开关逻辑
                var oBut = document.querySelector(".outer .toolbar .but");
                var oToolBar = document.querySelector(".outer .toolbar");
                //定义一个开关，保存当前是展开还是缩起来
                var flag = true;//默认是闭合的
                oBut.onclick = function () {
                    if (flag) {
                        oToolBar.className = "toolbar toolbar-out";
                        this.className = "but pull-wrap"
                    } else {
                        oToolBar.className = "toolbar toolbar-wrap";
                        this.className = "but list"
                    }
                    flag = !flag;
                }


                // 鼠标掠过展开小图标逻辑
                var oPull = document.querySelectorAll(".outer .pull");
                var oTabIcon = document.querySelectorAll(".outer .pull .tab-icon");
                var oTabText = document.querySelectorAll(".outer .pull em");
                for (var i = 0; i < oPull.length; i++) {
                    oPull[i].index = i;
                    oPull[i].onmouseenter = function () {
                        oTabText[this.index].style.left = "-59px";
                        oTabText[this.index].style.backgroundColor = "#c81122";
                        oTabIcon[this.index].style.backgroundColor = "#c81122";
                    }
                    oPull[i].onmouseleave = function () {
                        oTabText[this.index].style.left = "35px";
                        oTabText[this.index].style.backgroundColor = "#7a6e6e";
                        oTabIcon[this.index].style.backgroundColor = "#7a6e6e";
                    }
                }
            }

            //打开页面现货区localStorage添加的数据
            addNewData();
            function addNewData() {
                var newDataStr = localStorage.getItem("goodCon");
                console.log(newDataStr);
                if (newDataStr) {
                    //把json字符串转换成对象
                    var newData = JSON.parse(newDataStr);
                    console.log(newData);
                    // 把获取到的数据插入到原数据中
                    cartData.goods.unshift(newData);
                }

            }

            //购物车数据动态生成
            cartDataShow();
            function cartDataShow() {
                console.log(cartData.goods)
                cartData.goods.forEach(function (item) {
                    var oCartCon = `
                        <ul>
                            <li class="cart-list-con1">
                                <input type="checkbox">
                            </li>
                            <li class="cart-list-con2">
                                <img src="${item.goodImg}" alt="">
                                <div>${item.goodTitle}</div>
                            </li>
                            <li class="cart-list-con3">
                                <div class="item-txt">${item.goodTxt}</div>
                            </li>
                            <li class="cart-list-con4">
                                <span class="price">${item.goodPrice}</span>
                            </li>
                            <li class="cart-list-con5">
                                <a href="###" class="mins">-</a>
                                <input type="text" value="${item.goodNum}" minmun="1" class="itxt">
                                <a href="###" class="plus">+</a>
                            </li>
                            <li class="cart-list-con6">
                                <span>399.00</span>
                            </li>
                            <li class="cart-list-con7">
                                <a href="###" class="sindelete">删除</a>
                                <br>
                                <a href="###">移到收藏栏</a>
                            </li>
                        </ul>
                    `;

                    var oCartBody = document.querySelector(".cart .cart-main .cart-body");
                    oCartBody.innerHTML += oCartCon;
                })
            }


            //2.购物车功能
            cart();
            function cart() {

                //1.全选按钮功能
                //获取全选按钮
                var oChooseAll = document.querySelector(".cart .cart-main .cart-tool .select-all input");
                //对全选按钮绑定事件
                oChooseAll.onchange = function () {
                    var flag = this.checked;//获取点击后 全选框的状态
                    var oCheckBoxs = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con1 input");
                    if (flag) {
                        oCheckBoxs.forEach(function (item) {
                            item.checked = true;
                        })
                    } else {
                        oCheckBoxs.forEach(function (item) {
                            item.checked = false;
                        })
                    }

                    totalPrice();
                    counts();
                }


                //2.单选的时候对 全选的控制
                var oCheckBoxs = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con1 input");
                oCheckBoxs.forEach(function (item) {
                    item.onchange = function () {
                        //先获取 多选框的总长度
                        var CL = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con1 input").length;
                        //再获取 已经选中元素的总长度
                        var CH = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con1 input:checked").length;

                        if (CH == CL) {
                            oChooseAll.checked = true;
                        } else {
                            oChooseAll.checked = false;
                        }


                        totalPrice();
                        counts();
                    }

                })


                //3.数目加法
                var oPlus = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con5 .plus");
                oPlus.forEach(function (item) {
                    item.onclick = function () {
                        //获取原有数量  通过当前点击的元素 找到对应的input框  然后 获取input的value值
                        var num = parseInt(this.parentNode.querySelector(".itxt").value);
                        //获取当前点击元素的 对应的单价
                        var price = parseFloat(this.parentNode.parentNode.querySelector(".cart-list-con4 .price").innerHTML);

                        //数量加1
                        num++;
                        //把新的数量赋值给input元素
                        this.parentNode.querySelector(".itxt").value = num;
                        //计算新的价钱给 小计一栏
                        this.parentNode.parentNode.querySelector(".cart-list-con6 span").innerHTML = (num * price).toFixed(2);


                        totalPrice();
                        counts();
                    }
                })


                //4.数目减法
                var oMins = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con5 .mins");
                oMins.forEach(function (item) {
                    item.onclick = function () {
                        //获取原有数量  通过当前点击的元素 找到对应的input框  然后 获取input的value值
                        var num = parseInt(this.parentNode.querySelector(".itxt").value);
                        //获取当前点击元素的 对应的单价
                        var price = parseFloat(this.parentNode.parentNode.querySelector(".cart-list-con4 .price").innerHTML);

                        //数量加1
                        num--;
                        //数量最少是1
                        if (num <= 1) {
                            num = 1;
                        }
                        //把新的数量赋值给input元素
                        this.parentNode.querySelector(".itxt").value = num;
                        //计算新的价钱给 小计一栏
                        this.parentNode.parentNode.querySelector(".cart-list-con6 span").innerHTML = (num * price).toFixed(2);

                        totalPrice();
                        counts();

                    }
                })

                //5.单行删除
                var oSinDelete = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con7 .sindelete");
                oSinDelete.forEach(function (item) {
                    item.onclick = function () {
                        //判断当前删除项 的选择按钮是否被选中
                        var flag = item.parentNode.parentNode.querySelector(".cart-list-con1 input").checked;
                        if (flag) {
                            if (confirm("是否确定删除")) {
                                //移除当前元素所在的项
                                item.parentNode.parentNode.parentNode.removeChild(item.parentNode.parentNode);

                                //如果所有的选项全部删了，则把全选按钮给取消掉
                                //获取所有项的选择按钮
                                var oCheckBoxs = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con1 input");
                                var CL = oCheckBoxs.length;
                                // 判断CL的长度，如果为0 则所有项删除完毕，取消全选按钮
                                if (CL === 0) {
                                    oChooseAll.checked = false;
                                }
                            }
                        }

                        totalPrice();
                        counts();
                    }
                })

                //6.全部选中的被删除
                var oDeleteAll = document.querySelector(".cart .cart-main .cart-tool .option .deleteAll");
                oDeleteAll.onclick = function () {
                    //获取所有项的选择按钮
                    var oCheckBoxs = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con1 input");
                    oCheckBoxs.forEach(function (item) {
                        if (item.checked) {
                            // if (confirm("真的要删除吗？")) {
                            //移除当前元素所在的项
                            item.parentNode.parentNode.parentNode.removeChild(item.parentNode.parentNode);

                            //如果所有的选项全部删了，则把全选按钮给取消掉
                            //获取所有项的选择按钮
                            var oCheckBoxs = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con1 input");
                            var CL = oCheckBoxs.length;
                            // 判断CL的长度，如果为0 则所有项删除完毕，取消全选按钮
                            if (CL === 0) {
                                oChooseAll.checked = false;
                            }
                            // }

                        }
                    })
                    totalPrice();
                    counts();
                }

                //计算总价
                totalPrice();
                function totalPrice() {
                    //获取所有被选中的 项的勾选框
                    var oCheckBoxChecked = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con1 input:checked");
                    //遍历所有被选中的项 累加他们的价钱
                    var price = 0;
                    oCheckBoxChecked.forEach(function (item) {
                        price += parseFloat(item.parentNode.parentNode.querySelector(".cart-list-con6 span").innerHTML)
                    })
                    //把计算好的总价赋值给总价的元素
                    var oSumMoney = document.querySelector(".cart .cart-main .cart-tool .money-box .sumprice .summoney");
                    oSumMoney.innerHTML = price;
                }

                //计算总个数函数
                counts();
                function counts() {
                    //获取所有被选中的 项的勾选框
                    var oCheckBoxChecked = document.querySelectorAll(".cart .cart-main .cart-body > ul .cart-list-con1 input:checked");
                    var num = 0;
                    oCheckBoxChecked.forEach(function (item) {
                        num += parseFloat(item.parentNode.parentNode.querySelector(".itxt").value);
                    })

                    //获取放置总个数的元素
                    var oAllNum = document.querySelector(".cart .cart-main .cart-tool .money-box .choosed span");
                    oAllNum.innerHTML = num;
                }

            }

        })



    </script>


</body>

</html>